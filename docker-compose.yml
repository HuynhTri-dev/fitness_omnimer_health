version: "3.8"

services:
  # 1. ğŸŒ Node.js Backend Server (omnimer_health_server)
  backend:
    container_name: omnimer_health_backend
    build:
      context: ./omnimer_health_server # ÄÆ°á»ng dáº«n Ä‘áº¿n thÆ° má»¥c chá»©a Dockerfile cá»§a Node.js
      dockerfile: Dockerfile
    volumes:
      # Mount code Ä‘á»ƒ há»— trá»£ Live Reloading
      - ./omnimer_health_server:/usr/src/app
      # NgÄƒn cháº·n ghi Ä‘Ã¨ thÆ° má»¥c node_modules tá»« mÃ¡y host
      - /usr/src/app/node_modules
    ports:
      - "8000:8000" # Má»Ÿ cá»•ng API
    env_file:
      - ./omnimer_health_server/.env # Load biáº¿n mÃ´i trÆ°á»ng (chá»©a thÃ´ng tin káº¿t ná»‘i Cloud DB/Redis)
    # ÄÃ£ loáº¡i bá» depends_on vÃ¬ DB/Redis cháº¡y trÃªn Cloud

  # 2. ğŸ¤– Python AI/FastAPI Service (3T-FIT)
  ai_service:
    container_name: omnimer_health_ai
    build:
      context: ./3T-FIT # ÄÆ°á»ng dáº«n Ä‘áº¿n thÆ° má»¥c chá»©a Dockerfile cá»§a Python
      dockerfile: Dockerfile
    volumes:
      - ./3T-FIT:/usr/src/app
      # NgÄƒn cháº·n ghi Ä‘Ã¨ thÆ° má»¥c mÃ´i trÆ°á»ng áº£o
      - /usr/src/app/venv
    ports:
      - "8888:8888" # Má»Ÿ cá»•ng FastAPI
    environment:
      PYTHONUNBUFFERED: 1
    # KhÃ´ng cáº§n depends_on
