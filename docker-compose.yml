services:
  # 1. üåê Node.js Backend Server (omnimer_health_server)
  backend:
    container_name: omnimer_health_backend
    build:
      context: ./omnimer_health_server
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "8000:8000"
    env_file:
      - ./omnimer_health_server/.env
    environment:
      - PORT=8000
      - NODE_ENV=production
      # N·∫øu model l√† online/cloud, h√£y ƒëi·ªÅn URL c·ªßa server ƒë√≥ v√†o ƒë√¢y (ho·∫∑c trong file .env)
      # N·∫øu ch·∫°y qua proxy tr√™n m√°y host, d√πng http://host.docker.internal:11434
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL:-http://host.docker.internal:11434}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - omnimer_network
    depends_on:
      - graphdb

  # 2. ü§ñ Python AI/FastAPI Service (3T-FIT)
  ai_service:
    container_name: omnimer_health_ai
    build:
      context: ./3T-FIT
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "8888:8888"
    environment:
      - PYTHONUNBUFFERED=1
    networks:
      - omnimer_network

  # 3. üï∏Ô∏è GraphDB (Knowledge Graph)
  graphdb:
    image: ontotext/graphdb:11.2.0
    container_name: omnimer_health_graphdb
    ports:
      - "7200:7200"
    environment:
      - GDB_HEAP_SIZE=2G
    networks:
      - omnimer_network
    volumes:
      - ./graphdb_data:/opt/graphdb/home

  # 4. üñ•Ô∏è Admin Dashboard (React/Vite)
  admin_page:
    container_name: omnimer_admin_page
    build:
      context: ./adminpage
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "3000:80"
    networks:
      - omnimer_network

networks:
  omnimer_network:
    driver: bridge
